// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

Table tags {
  tag_id string
  app_id integer
}

Table app {
  app_id integer [primary key]
  app_name string
  icon string
  price float
  rating float
  downloads integer
  tag_ids string_array
}

Table app_page {
  app_id integer [primary key]
  description string
  images string_array
  last_update timestamp
  comment_ids string_array
}

Table comments {
  comment_id integer [primary key]
  app_id integer
  user_id integer
  stars float
  comment string
  date timestamp
}

Table user {
  user_id integer [primary key]
  username string
  creation_date timestamp
  comment_ids string_array
  app_ids string_array
  report_ids string_array
}

Table reports {
  report_id integer [primary key]
  reported_app_id integer
  reported_user_id integer
  comment string
  created_at timestamp
}

// Excalidraw: https://excalidraw.com/#json=f9zteWcQKq6YtgGwqZFOk,pLjObAh23cn_OaDurexHUA



Ref: "user"."app_ids" < "app"."app_id"

Ref: "app"."app_id" <> "app_page"."app_id"

Ref: "app_page"."comment_ids" < "comments"."comment_id"

Ref: "app"."tag_ids" < "tags"."app_id"

Ref: "comments"."user_id" < "user"."user_id"


Ref: "comments"."app_id" < "app"."app_id"





new ---------------------------------------------------------------------------


// Use DBML to define your database structure
// Based on init.py schema definition

Table user {
  user_id integer [primary key, increment]
  username text [not null]
  creation_date datetime [default: `CURRENT_TIMESTAMP`]
  comment_ids text [note: 'JSON Array Cache']
  app_ids text [note: 'JSON Array Cache']
}

Table app {
  app_id integer [primary key, increment]
  app_name text [not null]
  icon text
  price real [default: 0.0]
  rating real [default: 0.0]
  downloads integer [default: 0]
  developer_id integer
}

Table user_apps {
  app_id integer
  user_id integer

  indexes {
    (app_id, user_id) [pk] // Composite Primary Key
  }
}

Table comments {
  comment_id integer [primary key, increment]
  app_id integer [not null]
  user_id integer [not null]
  stars real
  comment text
  date datetime [default: `CURRENT_TIMESTAMP`]
}

Table app_page {
  app_id integer [primary key]
  description text
  images text [note: 'JSON Array']
  last_update datetime
  comment_ids text [note: 'JSON Array Cache']
}

Table tags {
  tag_id text [primary key]
  amount integer [default: 0]
  similar_tag_ids text [note: 'JSON Array']
}

Table app_tags {
  app_id integer
  tag_id text

  indexes {
    (app_id, tag_id) [pk] // Composite Primary Key
  }
}

Table reports {
  report_id integer [primary key, increment]
  reported_app_id integer
  reported_user_id integer
  reported_comment_id integer
  comment text
  created_at datetime [default: `CURRENT_TIMESTAMP`]
}

Table user_reports {
  user_id integer [primary key]
  report_ids text [note: 'JSON Array Cache']
}

Table app_reports {
  app_id integer [primary key]
  report_ids text [note: 'JSON Array Cache']
}

// --- Relationships ---

// App Developer Relationship
Ref: app.developer_id > user.user_id [delete: set null]

// User <-> Apps (Many-to-Many via user_apps)
Ref: user_apps.app_id > app.app_id [delete: cascade]
Ref: user_apps.user_id > user.user_id [delete: cascade]

// Comments
Ref: comments.app_id > app.app_id [delete: cascade]
Ref: comments.user_id > user.user_id [delete: cascade]

// App Page (1-to-1 extension of App)
Ref: app_page.app_id - app.app_id [delete: cascade]

// App <-> Tags (Many-to-Many via app_tags)
Ref: app_tags.app_id > app.app_id [delete: cascade]
Ref: app_tags.tag_id > tags.tag_id [delete: cascade]

// Reports (Optional relationships)
Ref: reports.reported_app_id > app.app_id [delete: set null]
Ref: reports.reported_user_id > user.user_id [delete: set null]
Ref: reports.reported_comment_id > comments.comment_id [delete: set null]

// Report Caches (1-to-1 link to the entity)
Ref: user_reports.user_id - user.user_id [delete: cascade]
Ref: app_reports.app_id - app.app_id [delete: cascade]

Ref: "user"."report_ids" < "reports"."report_id"


link: https://dbdiagram.io/d
